<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="./Style.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Calculator</title>
    </head>
    <body>
        <body>
            <div class="calculator" role="application" aria-label="Calculator">
                <div class="display" aria-live="polite">
                    <div class="previous" id="previous"></div>
                    <div class="current" id="current">0</div>
                </div>

                <div class="keypad" role="group" aria-label="Calculator keypad">
                    <button class="key clear" data-action="clear"
                        aria-label="Clear">C</button>
                    <button class="key del" data-action="delete"
                        aria-label="Delete">⌫</button>
                    <button class="key op" data-action="operator" data-value="%"
                        aria-label="Percent">%</button>
                    <button class="key op" data-action="operator" data-value="÷"
                        aria-label="Divide">÷</button>

                    <button class="key" data-action="digit"
                        data-value="7">7</button>
                    <button class="key" data-action="digit"
                        data-value="8">8</button>
                    <button class="key" data-action="digit"
                        data-value="9">9</button>
                    <button class="key op" data-action="operator" data-value="×"
                        aria-label="Multiply">×</button>

                    <button class="key" data-action="digit"
                        data-value="4">4</button>
                    <button class="key" data-action="digit"
                        data-value="5">5</button>
                    <button class="key" data-action="digit"
                        data-value="6">6</button>
                    <button class="key op" data-action="operator" data-value="-"
                        aria-label="Minus">−</button>

                    <button class="key" data-action="digit"
                        data-value="1">1</button>
                    <button class="key" data-action="digit"
                        data-value="2">2</button>
                    <button class="key" data-action="digit"
                        data-value="3">3</button>
                    <button class="key op" data-action="operator" data-value="+"
                        aria-label="Plus">+</button>

                    <button class="key wide" data-action="digit"
                        data-value="0">0</button>
                    <button class="key" data-action="digit"
                        data-value=".">.</button>
                    <button class="key eq" data-action="equals"
                        aria-label="Equals">=</button>
                </div>
            </div>

        </body>
        <!-- <script src="./script.js"></script> -->

      <script>
    (function(){
      const previousEl = document.getElementById('previous');
      const currentEl = document.getElementById('current');
      const keys = document.querySelectorAll('.keypad .key');

      let current = '';
      let previous = '';    // previous expression shown
      let operator = null;  // last operator symbol
      let justCalculated = false;

      function updateDisplay() {
        previousEl.textContent = previous;
        currentEl.textContent = current === '' ? '0' : current;
      }

      function inputDigit(d) {
        if (justCalculated) { // start fresh after equals
          current = "";
          previous = "";
          operator = null;
          justCalculated = false;
        }
        // prevent multiple leading zeros
        if (d === '0' && current === '0') return;
        // handle decimal
        if (d === '.') {
          if (current.includes('.')) return;
          if (current === '') current = '0'; // ".5" becomes "0.5"
          current += '.';
          updateDisplay();
          return;
        }
        // append digit
        current += d;
        updateDisplay();
      }

      function clearAll() {
        current = '';
        previous = '';
        operator = null;
        justCalculated = false;
        updateDisplay();
      }

      function deleteLast() {
        if (justCalculated) {
          // if last action was equals, clearing current result
          current = '';
          justCalculated = false;
          updateDisplay();
          return;
        }
        current = current.slice(0, -1);
        updateDisplay();
      }

      function handleOperator(opSymbol) {
        // convert percent into immediate operation
        if (opSymbol === '%') {
          if (current === '') return;
          const val = parseFloat(current);
          if (isNaN(val)) return;
          current = String(val / 100);
          updateDisplay();
          return;
        }

        // if there's no current but there is previous, allow change of operator
        if (current === '' && previous !== '') {
          // change operator displayed
          previous = previous.slice(0, -1) + opSymbol;
          operator = opSymbol;
          updateDisplay();
          return;
        }

        // first entry
        if (previous === '') {
          if (current === '') return;
          previous = current + opSymbol;
          current = '';
          operator = opSymbol;
          updateDisplay();
          return;
        }

        // if there is a previous and current, compute intermediate result
        if (previous !== '' && current !== '') {
          const result = evaluateExpression(previous, current, operator);
          if (result === null) return showError();
          previous = String(result) + opSymbol;
          current = '';
          operator = opSymbol;
          updateDisplay();
        }
      }

      function equals() {
        if (previous === '' || current === '') return;
        const result = evaluateExpression(previous, current, operator);
        if (result === null) return showError();
        previous = previous + current + ' =';
        current = String(result);
        operator = null;
        justCalculated = true;
        updateDisplay();
      }

      function showError() {
        current = 'Error';
        previous = '';
        operator = null;
        justCalculated = true;
        updateDisplay();
      }

      // Evaluate math using operator mapping (avoids eval on raw symbols)
      function evaluateExpression(prevStr, currStr, op) {
        // Convert symbols to simple numbers and operators
        const a = parseFloat(prevStr);
        const b = parseFloat(currStr);
        if (isNaN(a) || isNaN(b)) return null;
        switch (op) {
          case '+': return +(a + b).toPrecision(12);
          case '-': return +(a - b).toPrecision(12);
          case '×': return +(a * b).toPrecision(12);
          case '÷':
            if (b === 0) return null;
            return +(a / b).toPrecision(12);
          default: return null;
        }
      }

      // Click handlers
      keys.forEach(key => {
        key.addEventListener('click', () => {
          const action = key.dataset.action;
          const value = key.dataset.value;

          if (action === 'digit') {
            inputDigit(value);
          } else if (action === 'clear') {
            clearAll();
          } else if (action === 'delete') {
            deleteLast();
          } else if (action === 'operator') {
            handleOperator(value);
          } else if (action === 'equals') {
            equals();
          }
        });
      });

      // Keyboard support
      window.addEventListener('keydown', (e) => {
        const key = e.key;
        if ((key >= '0' && key <= '9') || key === '.') {
          e.preventDefault();
          inputDigit(key);
          return;
        }
        if (key === 'Enter' || key === '=') {
          e.preventDefault();
          equals();
          return;
        }
        if (key === 'Backspace') {
          e.preventDefault();
          deleteLast();
          return;
        }
        if (key === 'Escape') {
          e.preventDefault();
          clearAll();
          return;
        }
        // operators mapping
        if (key === '+' || key === '-') {
          e.preventDefault();
          handleOperator(key);
          return;
        }
        if (key === '*' || key === 'x' || key === 'X') {
          e.preventDefault();
          handleOperator('×');
          return;
        }
        if (key === '/') {
          e.preventDefault();
          handleOperator('÷');
          return;
        }
        if (key === '%') {
          e.preventDefault();
          handleOperator('%');
          return;
        }
      });

      // init
      clearAll();
    })();
  </script>
</html>